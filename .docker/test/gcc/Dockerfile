# gvm-libs-middleware-debian-buster-gcc-test

# please follow docker best practices
# https://docs.docker.com/develop/develop-images/dockerfile_best-practices/

# Use '-slim' image for reduced image size
FROM debian:buster-slim

# Provides a Debian buster image with the core build dependencies for gvm-libs
LABEL module="gvm-libs"
LABEL branch="middleware"
LABEL platform="debian-buster"
LABEL compiler="gcc"
LABEL configuration="test"

# This will make apt-get install without question
ARG DEBIAN_FRONTEND=noninteractive

# Install core dependencies required for building gvm-libs
RUN apt-get update && apt-get install --no-install-recommends --assume-yes \
    ca-certificates \
    cmake \
    gcc \
    git \
    libglib2.0-dev \
    libgnutls28-dev \
    libgpgme-dev \
    libhiredis-dev \
    libpcap-dev \
    libssh-gcrypt-dev \
    libxml2-dev \
    libnet1-dev \
    make \
    pkg-config \
    uuid-dev \
    libssl-dev \
 && rm -rf /var/lib/apt/lists/*

# clone and install mqtt paho
# workaround otherwise paho.mqtt.c creates man1 as a file
RUN mkdir /usr/local/share/man/man1

RUN git clone --depth 1 https://github.com/eclipse/paho.mqtt.c \
 && cd paho.mqtt.c \
 && make \
 && make install \
 && cd .. \
 && rm -rf paho.mqtt.c

# Install Debian core dependencies required for testing gvm-libs
# support and not yet installed as dependencies of gvm-libs-core
RUN apt-get update && apt-get install --assume-yes \
    g++ \
    lcov \
    libical-dev \
    libpq-dev \
    libnet1-dev \
    postgresql-server-dev-all \
    xsltproc \
 && rm -rf /var/lib/apt/lists/*

# install cgreen for unit tests
RUN git clone --depth 1 https://github.com/cgreen-devs/cgreen.git \
 && cd cgreen \
 && make \
 && make test \
 && make install \
 && cd .. \
 && rm -rf cgreen

ENV LD_LIBRARY_PATH="/usr/local/lib"
